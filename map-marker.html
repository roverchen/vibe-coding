<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>äº’å‹•å¼åœ°åœ–æ¨™è¨»å·¥å…·</title>
    <style>
        /* CSS æ¨£å¼ï¼šç¢ºä¿åœ–ç‰‡å’Œæ¨™è¨˜å®¹å™¨çš„å®šä½æ­£ç¢º */
        #map-container {
            position: relative; /* é—œéµï¼šè®“å…§éƒ¨çš„æ¨™è¨˜å¯ä»¥ç›¸å°æ–¼å®ƒå®šä½ */
            display: inline-block; /* è®“å®¹å™¨åªä½”åœ–ç‰‡çš„å¤§å° */
            cursor: crosshair; /* æ”¹è®Šé¼ æ¨™æ¨£å¼ï¼Œæç¤ºå¯ä»¥é»æ“Š */
        }
        
        .marker {
            position: absolute; /* è®“æ¨™è¨˜å¯ä»¥ç²¾ç¢ºå®šä½ */
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%; /* åœ“å½¢æ¨™è¨˜ */
            border: 2px solid white;
            transform: translate(-50%, -50%); /* è®“é»æ“Šçš„åº§æ¨™ä½æ–¼æ¨™è¨˜çš„ä¸­å¿ƒ */
            cursor: pointer;
            text-align: center;
            line-height: 16px;
            color: white;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s, background-color 0.2s;
        }

        .marker:hover {
            background-color: darkred;
            transform: translate(-50%, -50%) scale(1.2);
        }

        .marker-label {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            pointer-events: none; /* è®“é¼ æ¨™ç©¿é€æ¨™ç±¤ï¼Œåªé»æ“Šæ¨™è¨˜ */
            opacity: 0; /* é è¨­éš±è—æ¨™ç±¤ */
            transition: opacity 0.2s;
        }

        .marker:hover .marker-label {
            opacity: 1; /* é¼ æ¨™æ‡¸åœæ™‚é¡¯ç¤ºæ¨™ç±¤ */
        }

        #marker-list {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            max-height: 200px;
            overflow-y: auto;
            width: 400px;
        }

        .list-item {
            padding: 5px 0;
            cursor: pointer;
        }

    </style>
</head>
<body>

    <h2>ğŸ—ºï¸ çŠç‘šç‹åœ‹é¤¨äº’å‹•æ¨™è¨»</h2>

    <div id="map-container">
        <img id="map-image" src="https://ws.nmmba.gov.tw/001/Upload/226/ckfile/aeee9399-5776-4dc9-bc34-74f3de9610ad.jpg" alt="çŠç‘šç‹åœ‹é¤¨å¹³é¢åœ–">
        </div>

    <h3>ğŸ“ å·²å„²å­˜æ¨™è¨˜åˆ—è¡¨ (é»æ“Šå¯é‡æ–°é¸æ“‡åç¨±)</h3>
    <div id="marker-list">
        </div>

    <script>
        const mapContainer = document.getElementById('map-container');
        const mapImage = document.getElementById('map-image');
        const markerList = document.getElementById('marker-list');
        const STORAGE_KEY = 'mapMarkersData';
        let savedMarkers = [];

        // --- 1. è¼‰å…¥ä¸¦æ¸²æŸ“æ¨™è¨˜ ---
        function loadMarkers() {
            const data = localStorage.getItem(STORAGE_KEY);
            savedMarkers = data ? JSON.parse(data) : [];
            renderMarkers();
            renderMarkerList();
        }

        function saveMarkers() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(savedMarkers));
            renderMarkerList();
        }

        function renderMarkers() {
            // æ¸…ç©ºèˆŠçš„æ¨™è¨˜
            mapContainer.querySelectorAll('.marker').forEach(m => m.remove());

            savedMarkers.forEach((marker, index) => {
                const markerDiv = document.createElement('div');
                markerDiv.className = 'marker';
                markerDiv.style.left = `${marker.x}px`;
                markerDiv.style.top = `${marker.y}px`;
                markerDiv.innerHTML = `${index + 1}`; // é¡¯ç¤ºåºè™Ÿ

                const labelDiv = document.createElement('div');
                labelDiv.className = 'marker-label';
                labelDiv.textContent = marker.name;

                markerDiv.appendChild(labelDiv);
                mapContainer.appendChild(markerDiv);
            });
        }

        function renderMarkerList() {
             // æ¸²æŸ“å·²å„²å­˜åç¨±çš„æ¸…å–® (ç”¨æ–¼é¸æ“‡æ—¢æœ‰åç¨±)
            markerList.innerHTML = '';
            const uniqueNames = [...new Set(savedMarkers.map(m => m.name))];

            if (uniqueNames.length === 0) {
                markerList.innerHTML = 'å°šç„¡å·²å„²å­˜çš„åç¨±ã€‚';
                return;
            }

            uniqueNames.forEach(name => {
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.textContent = `åç¨±ï¼š${name}`;
                // é»æ“Šæ¸…å–®é …ç›®æ™‚ï¼Œå„²å­˜æ–°çš„æ¨™è¨˜åç¨±
                listItem.onclick = () => {
                    const latestClick = JSON.parse(localStorage.getItem('latestClickCoords'));
                    if (latestClick) {
                        addMarker(latestClick.x, latestClick.y, name);
                        alert(`å·²å°‡æ¨™è¨˜ (${latestClick.x}, ${latestClick.y}) å‘½åç‚º "${name}"`);
                        // æ¸…é™¤æœ€æ–°çš„é»æ“Šåº§æ¨™
                        localStorage.removeItem('latestClickCoords');
                    } else {
                        alert('è«‹å…ˆåœ¨åœ–ç‰‡ä¸Šé»æ“Šæ–°çš„ä½ç½®ï¼');
                    }
                };
                markerList.appendChild(listItem);
            });
        }
        
        // --- 2. è™•ç†é»æ“Šäº‹ä»¶ ---
        mapContainer.addEventListener('click', (event) => {
            // è¨ˆç®—ç›¸å°æ–¼åœ–ç‰‡å®¹å™¨çš„åº§æ¨™
            const x = event.offsetX;
            const y = event.offsetY;

            // å„²å­˜æœ€æ–°çš„é»æ“Šåº§æ¨™ï¼Œä»¥ä¾¿åœ¨æ¸…å–®ä¸­é¸æ“‡åç¨±æ™‚ä½¿ç”¨
            localStorage.setItem('latestClickCoords', JSON.stringify({ x, y }));
            
            // å½ˆå‡ºå°è©±æ¡†è®“ä½¿ç”¨è€…è¼¸å…¥æ–°åç¨±
            const newName = prompt(`æ‚¨é»æ“Šçš„åº§æ¨™æ˜¯ (X: ${x}, Y: ${y})ã€‚è«‹è¼¸å…¥æ–°åç¨±ï¼Œæˆ–é»æ“Šä¸‹æ–¹åˆ—è¡¨é¸æ“‡æ—¢æœ‰åç¨±ï¼š`);

            if (newName) {
                addMarker(x, y, newName);
            } else if (newName === "") {
                alert("åç¨±ä¸èƒ½ç‚ºç©ºã€‚è«‹é‡æ–°é»æ“Šä¸¦è¼¸å…¥ã€‚");
            } else {
                alert("å·²å–æ¶ˆæ¨™è¨˜ã€‚å¦‚è¦ä½¿ç”¨æ—¢æœ‰åç¨±ï¼Œè«‹é»æ“Šä¸‹æ–¹åˆ—è¡¨çš„åç¨±ã€‚");
            }
        });

        // --- 3. æ–°å¢æ¨™è¨˜é‚è¼¯ ---
        function addMarker(x, y, name) {
            savedMarkers.push({ x, y, name });
            saveMarkers(); // å„²å­˜åˆ° Local Storage
            renderMarkers(); // é‡æ–°ç¹ªè£½æ‰€æœ‰æ¨™è¨˜
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.onload = loadMarkers;
        
    </script>

</body>
</html>