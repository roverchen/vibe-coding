<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥èªŒåˆ†æ - æµ·ç”Ÿé¤¨ç ”ç©¶ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <header class="bg-slate-800 p-6 text-white flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold">ğŸ“‹ ç ”ç©¶æ—¥èªŒç¸½è¦½</h1>
                    <p class="text-slate-400 text-xs">æŒ‰ã€Œå›ä¸Šä¸€é ã€å¯è¿”å›åœ°åœ–ç´€éŒ„ç•«é¢</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="exportCSV()" class="bg-emerald-600 px-4 py-2 rounded text-xs font-bold">ğŸ“¥ å°å‡º CSV</button>
                    <button onclick="clearData()" class="bg-rose-600 px-4 py-2 rounded text-xs font-bold">ğŸ—‘ï¸ å…¨éƒ¨æ¸…é™¤</button>
                </div>
            </header>
            
            <div class="p-4 bg-slate-50 border-b flex justify-between items-center">
                <a href="recorder.html" class="text-indigo-600 font-bold text-sm">â¬…ï¸ è¿”å›ç´€éŒ„ç•«é¢</a>
                <div id="stats" class="text-xs text-slate-500 font-mono"></div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-slate-100 text-slate-600 text-xs uppercase">
                        <tr>
                            <th class="p-4 border-b">æ™‚é–“</th><th class="p-4 border-b">ç·¨è™Ÿ</th>
                            <th class="p-4 border-b">é †åº</th><th class="p-4 border-b">è¡Œç‚º</th>
                            <th class="p-4 border-b">åº§æ¨™</th><th class="p-4 border-b">é¤¨å€</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const LOG_KEY = 'nmmba_research_v1';
        let logs = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');

        function renderTable() {
            const body = document.getElementById('table-body');
            body.innerHTML = '';
            logs.forEach(log => {
                const tr = `<tr>
                    <td class="p-4 text-slate-400 font-mono text-xs">${log.timestamp.split(' ')[1]}</td>
                    <td class="p-4 font-bold">${log.sessionId}</td>
                    <td class="p-4 font-mono">#${log.sequence}</td>
                    <td class="p-4 font-semibold">${log.action}</td>
                    <td class="p-4 text-slate-400 italic">${log.x}, ${log.y}</td>
                    <td class="p-4 text-slate-500">${log.map}</td>
                </tr>`;
                body.insertAdjacentHTML('beforeend', tr);
            });
            document.getElementById('stats').textContent = `COUNT: ${logs.length}`;
        }

        function clearData() {
            if (confirm("âš ï¸ ç¢ºå®šè¦åˆªé™¤ã€Œæ‰€æœ‰ã€ç ”ç©¶æ•¸æ“šå—ï¼Ÿ")) {
                localStorage.removeItem(LOG_KEY);
                logs = [];
                renderTable();
                alert("å·²æ¸…é™¤ã€‚ç¾åœ¨æ‚¨å¯ä»¥æŒ‰ã€Œå›ä¸Šä¸€é ã€ç¹¼çºŒç´€éŒ„ã€‚");
            }
        }

        function exportCSV() {
            let csv = "\uFEFFæ™‚é–“,ç·¨è™Ÿ,é †åº,è¡Œç‚º,X,Y,é¤¨å€\n";
            logs.forEach(l => csv += `${l.timestamp},${l.sessionId},${l.sequence},${l.action},${l.x},${l.y},${l.map}\n`);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `ç ”ç©¶ç´€éŒ„_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }

        window.onload = renderTable;
    </script>
</body>
</html>